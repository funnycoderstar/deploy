(window.webpackJsonp=window.webpackJsonp||[]).push([[116],{458:function(P,v,C){"use strict";C.r(v);var _=C(33),n=Object(_.a)({},(function(){var P=this,v=P.$createElement,C=P._self._c||v;return C("ContentSlotsDistributor",{attrs:{"slot-key":P.$parent.slotKey}},[C("p",[P._v("DNS、HTTP、HTTPS 所在的层我们称为应用层。经过应用层封装后，浏览器会将应用层的包交给下一层去完成，通过 socket 编程来实现。下一层是传输层。\n传输层有两种协议，一种是无连接的协议 UDP，一种是面向连接的协议 TCP.\n传输层封装完毕后，浏览器会将包交给操作系统的网络层。网络层的协议是 IP 协议。\n操作系统如何将 IP 地址发给网关呢？在本地通信基本靠吼，于是操作系统大吼一声，谁是 192.168.1.1 啊？网关会回答它，我就是，我的本地地址在村东头。这个本地地址就是 MAC 地址，而大吼的那一声是 ARP 协议。于是操作系统将 IP 包交给了下一层，也就是 MAC 层。网卡再将包发出去。由于这个包里面是有 MAC 地址的，因而它能够到达网关。\n网关收到包之后，会根据自己的知识，判断下一步应该怎么走。网关往往是一个路由器，到某个 IP 地址应该怎么走，这个叫作路由表。")]),P._v(" "),C("p",[P._v("最后一个城关知道这个网络包要去的地方。于是，对着这个国家吼一声，谁是目标 IP 啊？目标服务器就会回复一个 MAC 地址。网络包过关后，通过这个 MAC 地址就能找到目标服务器。")]),P._v(" "),C("p",[P._v("目标服务器发现 MAC 地址对上了，取下 MAC 头来，发送给操作系统的网络层。发现 IP 也对上了，就取下 IP 头。IP 头里会写上一层封装的是 TCP 协议，然后将其交给传输层，即 TCP 层。")]),P._v(" "),C("ol",[C("li",[P._v("为什么网络要分层呀？因为不同的层次之间有不同的沟通方式，这个叫作协议。\n例如，一家公司也是分“层次”的，分总经理、经理、组长、员工。总经理之间有他们的沟通方式，经理和经理之间也有沟通方式，同理组长和员工。有没有听过类似的比喻？\n那么第一个问题来了。请问经理在握手的时候，员工在干什么？很多人听过 TCP 建立连接的三次握手协议，也会把它当知识点背诵。同理问你，TCP 在进行三次握手的时候，IP 层和 MAC 层对应都有什么操作呢？\n理解计算机网络中的概念，一个很好的角度是，想象网络包就是一段 Buffer，或者一块内存，是有格式的。同时，想象自己是一个处理网络包的程序，而且这个程序可以跑在电脑上，可以跑在服务器上，可以跑在交换机上，也可以跑在路由器上。你想象自己有很多的网口，从某个口拿进一个网络包来，用自己的程序处理一下，再从另一个网口发送出去。")])]),P._v(" "),C("p",[P._v("当然网络包的格式很复杂，这个程序也很复杂。复杂的程序都要分层，这是程序设计的要求。比如，复杂的电商还会分数据库层、缓存层、Compose 层、Controller 层和接入层，每一层专注做本层的事情")]),P._v(" "),C("p",[P._v("那 TCP 在三次握手的时候，IP 层和 MAC 层在做什么呢？当然是 TCP 发送每一个消息，都会带着 IP 层和 MAC 层了。因为，TCP 每发送一个消息，IP 层和 MAC 层的所有机制都要运行一遍。而你只看到 TCP 三次握手了，其实，IP 层和 MAC 层为此也忙活好久了。这里要记住一点：只要是在网络上跑的包，都是完整的。可以有下层没上层，绝对不可能有上层没下层。")]),P._v(" "),C("p",[P._v("对 TCP 协议来说，三次握手也好，重试也好，只要想发出去包，就要有 IP 层和 MAC 层，不然是发不出去的。")]),P._v(" "),C("p",[P._v("经常有人会问这样一个问题，我都知道那台机器的 IP 地址了，直接发给他消息呗，要 MAC 地址干啥？这里的关键就是，没有 MAC 地址消息是发不出去的。所以如果一个 HTTP 协议的包跑在网络上，它一定是完整的。无论这个包经过哪些设备，它都是完整的。所谓的二层设备、三层设备，都是这些设备上跑的程序不同而已。一个 HTTP 协议的包经过一个二层设备，二层设备收进去的是整个网络包。这里面 HTTP、TCP、 IP、 MAC 都有。什么叫二层设备呀，就是只把 MAC 头摘下来，看看到底是丢弃、转发，还是自己留着。那什么叫三层设备呢？就是把 MAC 头摘下来之后，再把 IP 头摘下来，看看到底是丢弃、转发，还是自己留着。")]),P._v(" "),C("p",[P._v("个人理解是ip可以保证要发送的包在网络中传输，到达目标服务器所在的局域网的网关，但是到了网关后，ip就没有用了，因为局域网中的ip对应的机器是不确定的，可能今天对应A机器，明天对应B机器。所以在局域网中使用ip寻址是不严谨的，这时就需要mac地址来唯一对应一台机器，这样网络包就可以准确的传输到需要的主机上了")]),P._v(" "),C("p",[P._v("从你的电脑，通过 SSH 登录到公有云主机里面，都需要经历哪些过程？或者说你打开一个电商网站，都需要经历哪些过程？说得越详细越好。")]),P._v(" "),C("h2",{attrs:{id:"你知道怎么查看-ip-地址吗？"}},[C("a",{staticClass:"header-anchor",attrs:{href:"#你知道怎么查看-ip-地址吗？"}},[P._v("#")]),P._v(" 你知道怎么查看 IP 地址吗？")]),P._v(" "),C("p",[P._v("在 Windows 上是 ipconfig，在 Linux 上是 ifconfig。Linux 上还有什么其他命令可以查看 IP 地址吗？答案是 ip addr")]),P._v(" "),C("p",[P._v("ifconfig 和 ip addr 的区别，这是一个有关 net-tools 和 iproute2 的“历史”故事")]),P._v(" "),C("p",[P._v("IP 地址是一个网卡在网络世界的通讯地址，相当于我们现实世界的门牌号码。\n如上输出的结果，10.100.122.2 就是一个 IP 地址。这个地址被点分隔为四个部分，每个部分 8 个 bit，所以 IP 地址总共是 32 位。因为不够用，于是就有了 IPv6")]),P._v(" "),C("p",[P._v("MAC 地址是一个很容易让人“误解”的地址。因为 MAC 地址号称全局唯一，不会有两个网卡有相同的 MAC 地址，而且网卡自生产出来，就带着这个地址。很多人看到这里就会想，既然这样，整个互联网的通信，全部用 MAC 地址好了，只要知道了对方的 MAC 地址，就可以把信息传过去。这样当然是不行的。 一个网络包要从一个地方传到另一个地方，除了要有确定的地址，还需要有定位功能。 而有门牌号码属性的 IP 地址，才是有远程定位功能的。")]),P._v(" "),C("p",[P._v("MAC 地址更像是身份证，是一个唯一的标识。它的唯一性设计是为了组网的时候，不同的网卡放在一个网络里面的时候，可以不用担心冲突。从硬件角度，保证不同的网卡有不同的标识。MAC 地址是有一定定位功能的，只不过范围非常有限。你可以根据 IP 地址，找到杭州市网商路 599 号 B 楼 6 层，但是依然找不到我，你就可以靠吼了，大声喊身份证 XXXX 的是哪位？我听到了，我就会站起来说，是我啊。但是如果你在上海，到处喊身份证 XXXX 的是哪位，我不在现场，当然不会回答，因为我在杭州不在上海。\n外包小哥")]),P._v(" "),C("ul",[C("li",[P._v("IP 是地址，有定位功能；")]),P._v(" "),C("li",[P._v("MAC 是身份证，无定位功能；")]),P._v(" "),C("li",[P._v("CIDR 可以用来判断是不是本地人；")]),P._v(" "),C("li",[P._v("IP 分公有的 IP 和私有的 IP。")])]),P._v(" "),C("h2",{attrs:{id:"那你知道-ping-是如何工作的吗？"}},[C("a",{staticClass:"header-anchor",attrs:{href:"#那你知道-ping-是如何工作的吗？"}},[P._v("#")]),P._v(" 那你知道 ping 是如何工作的吗？")]),P._v(" "),C("p",[P._v("ping 是基于 ICMP 协议工作的。ICMP 全称 Internet Control Message Protocol，就是互联网控制报文协议。这里面的关键词是“控制”，那具体是怎么控制的呢？\nping 命令执行的时候，源主机首先会构建一个 ICMP 请求数据包，ICMP 数据包内包含多个字段。最重要的是两个，第一个是类型字段，对于请求数据包而言该字段为 8；另外一个是顺序号，主要用于区分连续 ping 的时候发出的多个数据包。每发出一个请求数据包，顺序号会自动加 1。为了能够计算往返时间 RTT，它会在报文的数据部分插入发送时间。")])])}),[],!1,null,null,null);v.default=n.exports}}]);