(window.webpackJsonp=window.webpackJsonp||[]).push([[41],{226:function(t,s,n){"use strict";n.r(s);var a=n(0),e=Object(a.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h2",{attrs:{id:"浏览器和node事件循环的区别"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#浏览器和node事件循环的区别","aria-hidden":"true"}},[t._v("#")]),t._v(" 浏览器和Node事件循环的区别")]),t._v(" "),n("p",[t._v("Node10一下是和浏览器有区别的, Node11以上, 浏览器和Node的事件循环就保持一致了")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("test")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n   console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'start'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'children2'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        Promise"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'children2-1'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("   \n    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'children3'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        Promise"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'children3-1'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    Promise"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'children1'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'end'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" \n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("test")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 以上代码在node11以下版本的执行结果(先执行所有的宏任务，再执行微任务)")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// start")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// end")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// children1")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// children2")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// children3")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// children2-1")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// children3-1")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 以上代码在node11及浏览器的执行结果(顺序执行宏任务和微任务)")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// start")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// end")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// children1")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// children2")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// children2-1")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// children3")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// children3-1")]),t._v("\n")])])]),n("p",[t._v("Promise.nextTick和Promise的回调函数，追加在本轮循环，即同步任务一旦完成，就开始执行他们；\n而setTimeout， setInterval，setImmediate的回调函数，追加在次轮循环")]),t._v(" "),n("p",[t._v("\bJS事件分为同步和异步，异步认为宏任务和微任务")]),t._v(" "),n("p",[t._v("肯定会先执行同步任务，所以前两个会先输出 "),n("code",[t._v("start")]),t._v("， "),n("code",[t._v("end")])]),t._v(" "),n("p",[t._v("第一个setTimeout开启一个宏任务1，第二个setTimeout开启一个宏任务2，但没有宏任务可以执行")]),t._v(" "),n("p",[n("code",[t._v("Promise.resolve().then(() => {console.log('children1')})")]),t._v("开启一个微任务，立即执行，输出 "),n("code",[t._v("children1")]),t._v(",因为是追加在本轮循环的，且在同步任务后立即执行")]),t._v(" "),n("p",[t._v("接下来就有所不同了")]),t._v(" "),n("h3",{attrs:{id:"node11之前的是执行完所有宏任务，再执行所有微任务"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#node11之前的是执行完所有宏任务，再执行所有微任务","aria-hidden":"true"}},[t._v("#")]),t._v(" Node11之前的是执行完所有宏任务，再执行所有微任务")]),t._v(" "),n("ol",[n("li",[n("b",[t._v("执行一个宏任务: 执行 宏任务1，")])])]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'children2'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        Promise"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'children2-1'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  \n")])])]),n("p",[t._v("输出 "),n("code",[t._v("children2")]),t._v(",\n同时开启一个微任务1")]),t._v(" "),n("ol",{attrs:{start:"2"}},[n("li",[n("b",[t._v("执行一个宏任务: 执行 宏任务2，")])])]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'children3'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        Promise"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'children3-1'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  \n")])])]),n("p",[t._v("输出 "),n("code",[t._v("children3")]),t._v(",\n同时开启一个微任务1")]),t._v(" "),n("ol",{attrs:{start:"3"}},[n("li",[n("p",[n("b",[t._v("执行一个微任务: 宏任务执行完成，开始执行微任务1")]),t._v("：立即执行"),n("code",[t._v("children2-1'")])])]),t._v(" "),n("li",[n("p",[n("b",[t._v("执行一个微任务:  开始执行微任务2")]),t._v("：立即执行"),n("code",[t._v("children3-1'")])])])]),t._v(" "),n("p",[t._v("所以最后结果为")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 以上代码在node11及浏览器的执行结果(顺序执行宏任务和微任务)")]),t._v("\nstart\nend\nchildren1\nchildren2\nchildren3\nchildren2"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\nchildren3"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n")])])]),n("h3",{attrs:{id:"浏览器和node11都是先执行一个宏任务，再清空所有的微任务，再执行一个宏任务，再清空一个微任务"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#浏览器和node11都是先执行一个宏任务，再清空所有的微任务，再执行一个宏任务，再清空一个微任务","aria-hidden":"true"}},[t._v("#")]),t._v(" 浏览器和Node11都是先执行一个宏任务，再清空所有的微任务，再执行一个宏任务，再清空一个微任务......")]),t._v(" "),n("ol",[n("li",[n("b",[t._v("执行一个宏任务: 执行 宏任务1")])])]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'children2'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        Promise"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'children2-1'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  \n")])])]),n("p",[t._v("输出 "),n("code",[t._v("children2")]),t._v(",\n同时开启一个微任务1")]),t._v(" "),n("ol",{attrs:{start:"2"}},[n("li",[n("p",[n("b",[t._v("执行一个微任务: 宏任务1执行完成，开始执行微任务1")]),t._v("：立即执行"),n("code",[t._v("children2-1'")])])]),t._v(" "),n("li",[n("p",[n("b",[t._v("执行一个宏任务: 执行 宏任务2，")])])])]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'children3'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        Promise"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'children3-1'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  \n")])])]),n("p",[t._v("输出 "),n("code",[t._v("children3")]),t._v(",\n同时开启一个微任务1")]),t._v(" "),n("ol",{attrs:{start:"4"}},[n("li",[n("b",[t._v("执行一个微任务: 宏任务2执行完成，开始执行微任务2")]),t._v("：立即执行"),n("code",[t._v("children3-1'")])])]),t._v(" "),n("p",[t._v("所以最后结果为")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 以上代码在node11及浏览器的执行结果(顺序执行宏任务和微任务)")]),t._v("\nstart\nend\nchildren1\nchildren2\nchildren2"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\nchildren3\nchildren3"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n")])])]),n("h2",{attrs:{id:"浏览器的事件循环"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#浏览器的事件循环","aria-hidden":"true"}},[t._v("#")]),t._v(" 浏览器的事件循环")]),t._v(" "),n("ul",[n("li",[t._v("1.执行一个宏任务, 比如setTimeout, setInterval, script, I/O, 页面渲染")]),t._v(" "),n("li",[t._v("2.执行完微任务, 比如promise.resolve(), process.nextTick()")])]),t._v(" "),n("h2",{attrs:{id:"node的事件循环"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#node的事件循环","aria-hidden":"true"}},[t._v("#")]),t._v(" Node的事件循环")]),t._v(" "),n("p",[t._v("1.执行完一个阶段的所有任务\n2.执行完nextTick队列里面的内容\n2.然后执行完微任务队列的内容")]),t._v(" "),n("h2",{attrs:{id:"node的事件循环是libuv实现的"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#node的事件循环是libuv实现的","aria-hidden":"true"}},[t._v("#")]),t._v(" Node的事件循环是libuv实现的")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.suisuijiang.com/ImageMessage/5adad39555703565e79040fa_1554106811355.png?width=750&height=679&imageView2/3/",alt:"libuv"}})]),t._v(" "),n("p",[t._v("Javascript是单线程运行, 异步操作很重要.libuv这个库负责各种回调函数的执行时间, 毕竟异步任务最后还是要回到主线程,一个个排队执行")]),t._v(" "),n("p",[t._v("每一轮的事件循环, 分成六个阶段,这些阶段会依次执行")]),t._v(" "),n("ol",[n("li",[n("p",[t._v("timers(定时器): 本阶段已经安排的"),n("code",[t._v("setTimeout()")]),t._v("和"),n("code",[t._v("setInterval()")]),t._v("的回调函数")])]),t._v(" "),n("li",[n("p",[t._v("I/O callbacks:\n除了以下的操作函数, 其他的回调函数都在这个阶段执行.")])])]),t._v(" "),n("ul",[n("li",[t._v("setTimeout()和 setInterval()的回调函数")]),t._v(" "),n("li",[t._v("setImmediate()的回调函数")]),t._v(" "),n("li",[t._v("用于关闭请求的回调函数, 比如"),n("code",[t._v("socket.on('close', ...)")])])]),t._v(" "),n("ol",{attrs:{start:"3"}},[n("li",[t._v("idle(空闲), prepare: 该阶段只供libuv内容调用, 这里可以忽略")]),t._v(" "),n("li",[t._v("poll(轮询):\n轮询时间, 用于等待还未返回的 I/O事件, 比如服务器的响应, 用户移动鼠标等等;\n这个阶段的时间会比较长, 如果没有其他异步任务要处理(比如到时的定时器),会一直停留在这个阶段, 等到 I/O 请求返回结果")]),t._v(" "),n("li",[t._v("check: 该阶段执行"),n("code",[t._v("setImmediate()")]),t._v("的回调函数")]),t._v(" "),n("li",[t._v("close callbacks: 改阶段执行关闭请求的回调函数, 比如"),n("code",[t._v("socket.on('close', ...)")])])]),t._v(" "),n("h2",{attrs:{id:"js实现异步的原理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#js实现异步的原理","aria-hidden":"true"}},[t._v("#")]),t._v(" JS实现异步的原理")]),t._v(" "),n("h3",{attrs:{id:"_1-线程和进程"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-线程和进程","aria-hidden":"true"}},[t._v("#")]),t._v(" 1.线程和进程")]),t._v(" "),n("p",[t._v("Javascript是单线程的\n一个进程包括很多个线程")]),t._v(" "),n("h3",{attrs:{id:"_2-多进程和多线程"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-多进程和多线程","aria-hidden":"true"}},[t._v("#")]),t._v(" 2.多进程和多线程")]),t._v(" "),n("h2",{attrs:{id:"参考"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#参考","aria-hidden":"true"}},[t._v("#")]),t._v(" 参考")]),t._v(" "),n("p",[n("a",{attrs:{href:"http://www.ruanyifeng.com/blog/2018/02/node-event-loop.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Node 定时器详解"),n("OutboundLink")],1),t._v(" "),n("a",{attrs:{href:"https://github.com/Advanced-Frontend/Daily-Interview-Question/issues/26",target:"_blank",rel:"noopener noreferrer"}},[t._v("浏览器和Node 事件循环的区别"),n("OutboundLink")],1),t._v(" "),n("a",{attrs:{href:"https://juejin.im/post/5c337ae06fb9a049bc4cd218#heading-12",target:"_blank",rel:"noopener noreferrer"}},[t._v("浏览器与Node的事件循环(Event Loop)有何区别?"),n("OutboundLink")],1)])])}),[],!1,null,null,null);s.default=e.exports}}]);